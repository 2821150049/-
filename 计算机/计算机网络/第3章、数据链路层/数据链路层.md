# 数据链路层

**基本概念**

结点：主机、路由器

链路：网络中两个结点之间的`物理通道`，链路的传输截止主要是双绞线、光纤和微波。

数据链路：网络中两个结点之间的`逻辑信道`，把实现控制数据传输协议的硬件和软件加到链路上就构成了数据链路。

帧：链路层的协议数据单元，封装网络层的数据报。

**数据链路层的功能**

功能一：为网络层提供服务。无确认无连接服务、有确认无连接服务、有确认有连接服务。

功能二：链路管理，即连接的建立、维护、释放。

功能三：组帧。

功能四：流量控制。

功能五：差错控制。

## 一、封装成帧&透明传输

![1](img\1.png)

​		看到这个估计有人就有疑问，封装成帧的目的是什么，这里我举个栗子。比方说我们这里有一个文件，这个时候我们将它转换成2进制数据后会很大很大，这个时候我们就需要将数据进行切分，放到物理层去传输，传输过程中，我们是不是就不清楚到底从哪开始读数据呢，然后数据到哪结束算一组。这个时候我们就引入了封装成帧的思想。将每组数据加头，加尾做上标记。这样我就能确定每一帧的边界了，这个重要作用我们在计算机原理中有个官方的说法叫：`帧定界`。

​		当我们的每帧数据都加上了首部和尾部控制信息后，二进制比特流就能区分出帧的开始与结束，这样接收方就能很好的完成`帧同步`的操作。

​		说完了为啥要封装成帧，下面简单的说一下组帧的四种方法：`字符计数法、字符填充法、零比特填充法、违规编码法`。

1. **字符计数法**

​		帧首部使用一个计数字段来标明帧内字符数。

<img src="img\2.png" alt="2" style="zoom:67%;" />

==注意：这样做不是很好，因为当读的时候不是从第一帧的第一个字符开始读，从第二个字符开始，那么后面的每一帧数据都会错。==

2. **字符填充法**

<img src="img\3.png" alt="3" style="zoom:67%;" />

​		在每帧数据的头部加上`SOH(start of hard)`，在尾部加上`EOT(End of Transmission)`，这样做确实可以使我们更好的接收数据，但是当数据中出现了和头部信息和尾部信息相同的数据时，就会出现错误，这个时候就需要在这些特殊的数据前在加上一个特殊的标记。

<img src="img\4.png" alt="4" style="zoom:67%;" />

3. **零比特填充法**

​		这种方法也是在头部和尾部加上特殊数据`0111110`。但是，不管怎么加特殊数据，数据中，都有可能会出现和头部和尾部一样的数据，就好比下面的这种情况。这个时候就需要对数据进行处理。

<img src="img\5.png" alt="5" style="zoom:67%;" />

```C
变化规则：
	在发送端，扫描整个信息字段，只要连续5个1，就立即填入1个0。
	在接收端收到一个帧时，先找到标志字段确定边界，再用硬件对比特流进行扫描。发现连续5个1时，就把后面的0删除
这种方法遵循一个5 1 1 0原则。就是连续5个1，加1个0。
```

举个栗子：

![6](img\6.png)

4. **违规编码法**

​		这是一种在物理层上使用的编码方法，举个简单的栗子。

<img src="img\7.png" alt="7" style="zoom:67%;" />

​		这是一种曼彻斯特编码方式，当我们用“高-高”或“低-低”的定界符时，也可以起到相同的效果。

## 二、差错控制

​		当我们将数据能够封装成帧后，接收数据的过程中总会出现错误，先说一下会出现错误的两种可能，一个是`位错`，还有一个就是`帧错`。位错很简单就是比特位出错，帧错就是发送过程中出现了重复，失序或者丢失帧的问题。

​		这里主要先讨论的*比特错*的两种控制方法：`检错编码，纠错编码`。

1. **检错编码**

​		检错编码这里简单介绍两种方法：奇偶校验码、CRC循环冗余码。

​		==奇偶校验码==

![8](img\8.png)

有了上面的定义，我举个栗子给大家解释一下。当我们使用奇校验时，我们的数据假如是`10010`，数据中有2个1，也就是说，1的个数时偶数，这个时候我们要让数据中1的个数变成奇数个的方法就是，在最前面加上一个1就变成`1100010`。这样就是奇数个1了。这种校验的方法你是不是发现了存在一个弊端，是什么呢，就是当数据中有两个1同时变成0之后数据是`1000000`，那么就无法进行纠错了。也就是说这种纠错的检错能力只有50%。

​		==CRC循环冗余码==

​		在说这种检错方法前，我得引入两个概念：`生成多项式`、`FCS帧检验序列/冗余码`。

​		生成多项式其实没啥好怕的像啥样的呢，还是栗子比较好说：$k_nx^n+k_{n-1}x^{n-1}...+k_1n^0$这样的式子就叫生成多项式。前面的k~n~一般都是0或者1。

​		冗余码，就是用*要传的数据*除*生成多项式*之后，剩下的余数。这个余数加到要传数据的后面组成的数据就是我们组好的数据。

​		整个流程，见图。

![9](img\9.png)

​		同样的给个用例：

![10](img\10.png)

2. **纠错编码**

这里有个写的非常好的博客https://www.cnblogs.com/godoforange/p/12003676.html，所以我就不做过多的讲解了。

​		上面的编码方式只能检测错误，不能纠正错误，接下来要讲的就是一种可以纠正错误的编码方式：`海明码`。

## 三、流量控制及可靠传输



### 1.流量控制



1. **停止-等待协议**



2. **滑动窗口协议**





